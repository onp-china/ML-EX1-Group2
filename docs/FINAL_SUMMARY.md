# ğŸ‰ mnist-demo æ–‡ä»¶å¤¹åˆ›å»ºå®Œæˆï¼

> **å®Œæ•´çš„æ¨¡å‹è®­ç»ƒä»£ç  + æƒé‡æ–‡ä»¶ + æµ‹è¯•è„šæœ¬**

---

## âœ… å·²å®Œæˆå†…å®¹

### ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
mnist-demo/
â”œâ”€â”€ ğŸ“Š æ•°æ® (data/)
â”‚   â”œâ”€â”€ train.npz              # è®­ç»ƒé›† (10000æ ·æœ¬)
â”‚   â”œâ”€â”€ val.npz                # éªŒè¯é›† (2000æ ·æœ¬)
â”‚   â”œâ”€â”€ test_public.npz        # æµ‹è¯•é›† (2000æ ·æœ¬)
â”‚   â”œâ”€â”€ test_public_labels.csv # æµ‹è¯•é›†æ ‡ç­¾
â”‚   â””â”€â”€ meta.json              # å…ƒæ•°æ®
â”‚
â”œâ”€â”€ ğŸ¤– æ¨¡å‹æƒé‡ (models/)
â”‚   â”œâ”€â”€ stage1_improvedv2/     # Stage 1: ç‰¹å¾èåˆé©å‘½ (85.28%)
â”‚   â”œâ”€â”€ stage2_resnet_optimized/ # Stage 2: æ·±åº¦ä¼˜åŒ–çªç ´ (88.75%)
â”‚   â”‚   â”œâ”€â”€ resnet_optimized_1.12/  # æœ€ä½³å•æ¨¡å‹ â­
â”‚   â”‚   â”œâ”€â”€ resnet_fusion/          # 5å¤´èåˆç‰ˆæœ¬
â”‚   â”‚   â””â”€â”€ resnet_optimized/       # æ ‡å‡†ç‰ˆæœ¬
â”‚   â”œâ”€â”€ stage3_multi_seed/     # Stage 3: å¤šæ ·æ€§æ¢ç´¢ (87.39%)
â”‚   â”‚   â”œâ”€â”€ seed_2025/         # æœ€ä½³å¤šç§å­æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ fpn_model/         # FPNå¤šå°ºåº¦
â”‚   â”‚   â”œâ”€â”€ seed_2023/         # è½»é‡åŒ–ç‰ˆæœ¬
â”‚   â”‚   â”œâ”€â”€ seed_2024/         # å®½åŒ–ç‰ˆæœ¬
â”‚   â”‚   â””â”€â”€ resnet_fusion_seed*/ # Fusionå¤šç§å­
â”‚   â””â”€â”€ stage4_stacking/       # Stage 4: Stackingé›†æˆ (93.09%)
â”‚
â”œâ”€â”€ ğŸ’» æºä»£ç  (src/)
â”‚   â”œâ”€â”€ models/                # æ¨¡å‹æ¶æ„å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ simple_compare_cnn.py  # ResNetæ¶æ„
â”‚   â”‚   â””â”€â”€ fpn_architecture_v2.py # FPNæ¶æ„
â”‚   â”œâ”€â”€ data_loader.py         # æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ model_loader.py        # æ¨¡å‹åŠ è½½å™¨
â”‚   â””â”€â”€ stacking_ensemble.py   # Stackingé›†æˆ
â”‚
â”œâ”€â”€ ğŸ§ª æµ‹è¯•è„šæœ¬ (scripts/)
â”‚   â”œâ”€â”€ test_single_model.py   # å•æ¨¡å‹æµ‹è¯•
â”‚   â”œâ”€â”€ test_all_models.py     # å…¨æ¨¡å‹å¯¹æ¯”
â”‚   â””â”€â”€ training/              # è®­ç»ƒè„šæœ¬
â”‚       â”œâ”€â”€ train_stage1_improvedv2.py    # Stage 1è®­ç»ƒ
â”‚       â”œâ”€â”€ train_stage2_resnet_optimized.py # Stage 2è®­ç»ƒ
â”‚       â”œâ”€â”€ train_stage3_multi_seed.py    # Stage 3è®­ç»ƒ
â”‚       â”œâ”€â”€ run_stacking.py               # Stage 4é›†æˆ
â”‚       â””â”€â”€ README.md                     # è®­ç»ƒè¯´æ˜
â”‚
â”œâ”€â”€ âš™ï¸ é…ç½®æ–‡ä»¶ (configs/)
â”‚   â””â”€â”€ model_registry.json    # æ¨¡å‹æ³¨å†Œè¡¨
â”‚
â”œâ”€â”€ ğŸ“ˆ è¾“å‡ºç›®å½• (outputs/)
â”‚   â”œâ”€â”€ predictions/           # é¢„æµ‹ç»“æœ
â”‚   â”œâ”€â”€ metrics/               # æ€§èƒ½æŒ‡æ ‡
â”‚   â””â”€â”€ visualizations/        # å¯è§†åŒ–å›¾è¡¨
â”‚
â””â”€â”€ ğŸ“š æ–‡æ¡£
    â”œâ”€â”€ README.md              # é¡¹ç›®ä¸»æ–‡æ¡£
    â”œâ”€â”€ PRESENTATION_GUIDE.md  # 10åˆ†é’Ÿæ¼”è®²æŒ‡å—
    â”œâ”€â”€ PROJECT_INFO.md        # é¡¹ç›®è¯¦ç»†ä¿¡æ¯
    â”œâ”€â”€ TRAINING_GUIDE.md      # å®Œæ•´è®­ç»ƒæŒ‡å—
    â”œâ”€â”€ SETUP_COMPLETE.md      # å®Œæˆè¯´æ˜
    â”œâ”€â”€ requirements.txt       # ä¾èµ–åŒ…
    â”œâ”€â”€ quick_test.bat         # å¿«é€Ÿæµ‹è¯•è„šæœ¬
    â”œâ”€â”€ train_all_stages.bat   # ä¸€é”®è®­ç»ƒè„šæœ¬ (Windows)
    â””â”€â”€ train_all_stages.sh    # ä¸€é”®è®­ç»ƒè„šæœ¬ (Linux/Mac)
```

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. å®Œæ•´çš„æ¨¡å‹è®­ç»ƒä»£ç 

**å„é˜¶æ®µè®­ç»ƒè„šæœ¬**:
- âœ… **Stage 1**: `train_stage1_improvedv2.py` - 6å¤´èåˆ + CBAMæ³¨æ„åŠ›
- âœ… **Stage 2**: `train_stage2_resnet_optimized.py` - ResNet + Focal Loss + AMP
- âœ… **Stage 3**: `train_stage3_multi_seed.py` - å¤šç§å­ + æ¶æ„å¤šæ ·æ€§
- âœ… **Stage 4**: `run_stacking.py` - LightGBMå…ƒå­¦ä¹ å™¨é›†æˆ

**åŸå§‹è®­ç»ƒè„šæœ¬**:
- âœ… `train_88_83_multi_seed.py` - åŸå§‹ResNetè®­ç»ƒ
- âœ… `train_efficientnet_symmetric.py` - EfficientNetè®­ç»ƒ
- âœ… `train_multi_seed_optimized.py` - å¤šç§å­ä¼˜åŒ–è®­ç»ƒ

### 2. æ¨¡å‹æ¶æ„å®šä¹‰

**ResNetCompareNet**:
```python
# æ®‹å·®ç½‘ç»œ + SEæ³¨æ„åŠ› + 5å¤´èåˆ
class ResNetCompareNet(nn.Module):
    def __init__(self, feat_dim=256, layers=[2,2,2], block=BasicBlock):
        self.tower = ResNetTower(out_dim=feat_dim, layers=layers, block=block)
        self.attention = AttentionModule(feat_dim)
        # 5ç§ç‰¹å¾èåˆå¤´
        self.fusion_heads = nn.ModuleList([...])
```

**FPNCompareNetV2**:
```python
# ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œ + å¤šå°ºåº¦èåˆ
class FPNCompareNetV2(nn.Module):
    def __init__(self, feat_dim=256, layers=[2,2,2]):
        self.backbone = ResNetBackbone(layers=layers)
        self.fpn = FeaturePyramidNetwork(...)
```

### 3. è®­ç»ƒæŠ€æœ¯æ ˆ

**æŸå¤±å‡½æ•°**:
- BCEWithLogitsLoss (åŸºçº¿)
- Focal Loss (Î±=1.0, Î³=2.0) - å…³æ³¨éš¾æ ·æœ¬
- æ ‡ç­¾å¹³æ»‘ (label_smoothing=0.1)

**ä¼˜åŒ–å™¨**:
- AdamW (lr=1e-3, weight_decay=5e-4)
- ReduceLROnPlateau å­¦ä¹ ç‡è°ƒåº¦

**è®­ç»ƒæŠ€å·§**:
- æ··åˆç²¾åº¦è®­ç»ƒ (AMP)
- æ¢¯åº¦è£å‰ª (max_norm=1.0)
- æ—©åœæœºåˆ¶ (patience=5-10)
- æ•°æ®å¢å¼º (æ—‹è½¬ã€å¹³ç§»ã€ç¼©æ”¾)

### 4. é›†æˆå­¦ä¹ 

**Stackingé›†æˆ**:
```python
# 10ä¸ªåŸºç¡€æ¨¡å‹ + LightGBMå…ƒå­¦ä¹ å™¨
base_models = [
    "resnet_optimized_1.12",  # 88.75%
    "resnet_fusion",          # 87.92%
    "resnet_optimized",       # 87.80%
    "seed_2025",              # 87.39%
    "fpn_model",              # 87.30%
    # ... æ›´å¤šæ¨¡å‹
]

# LightGBMå…ƒå­¦ä¹ å™¨
lgb_model = LGBMClassifier(
    objective='binary',
    num_leaves=31,
    learning_rate=0.05,
    n_estimators=100
)
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•

```bash
# Windows
quick_test.bat

# æˆ–æ‰‹åŠ¨æµ‹è¯•
python scripts/test_single_model.py --model resnet_optimized_1.12
python scripts/test_all_models.py
```

### è®­ç»ƒæ¨¡å‹

```bash
# ä¸€é”®è®­ç»ƒæ‰€æœ‰é˜¶æ®µ
train_all_stages.bat  # Windows
./train_all_stages.sh # Linux/Mac

# æˆ–åˆ†é˜¶æ®µè®­ç»ƒ
python scripts/training/train_stage1_improvedv2.py
python scripts/training/train_stage2_resnet_optimized.py --layers 3,3,3
python scripts/training/train_stage3_multi_seed.py --seeds 42,2023,2024,2025
python scripts/training/run_stacking.py
```

### æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹æ¨¡å‹æ€§èƒ½
cat outputs/metrics/all_models_comparison.json

# æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
ls outputs/logs/

# æŸ¥çœ‹æ¨¡å‹æƒé‡
ls models/stage*/
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å„é˜¶æ®µæ€§èƒ½

| é˜¶æ®µ | ä»£è¡¨æ¨¡å‹ | å‡†ç¡®ç‡ | æå‡ | å…³é”®åˆ›æ–° |
|------|---------|--------|------|---------|
| Stage 0 | Baseline | 57.11% | - | ç®€å•CNN |
| Stage 1 | ImprovedV2 | 85.28% | +28.17% | 6å¤´èåˆ + CBAM |
| Stage 2 | ResNet-Opt-1.12 | 88.75% | +3.47% | Focal Loss + AMP |
| Stage 3 | Multi-Seed-2025 | 87.39% | æ¶æ„å¤šæ ·åŒ– | å¤šç§å­ + FPN |
| Stage 4 | Stacking | 93.09% | +4.34% | å…ƒå­¦ä¹ å™¨é›†æˆ |

**æ€»æå‡**: +35.98ä¸ªç™¾åˆ†ç‚¹ (62.96%ç›¸å¯¹æå‡)

### æµ‹è¯•é›†æ€§èƒ½

- **éªŒè¯é›†**: 93.09%
- **æµ‹è¯•é›†**: 90.30%
- **Stacking 5æŠ˜CV**: 89.07% Â± 1.13%

---

## ğŸ”§ æŠ€æœ¯ç‰¹è‰²

### 1. æ¨¡å‹æ¶æ„æ¼”è¿›

**ä»ç®€å•åˆ°å¤æ‚**:
```
ç®€å•CNN â†’ ResNet â†’ FPN â†’ Stacking
57%    â†’ 85%   â†’ 89% â†’ 93%
```

**å…³é”®æŠ€æœ¯åˆ›æ–°**:
- å¤šå¤´ç‰¹å¾èåˆ (6ç§æ–¹å¼)
- SE-Moduleé€šé“æ³¨æ„åŠ›
- Focal Losséš¾æ ·æœ¬æŒ–æ˜
- æ··åˆç²¾åº¦è®­ç»ƒåŠ é€Ÿ
- å…ƒå­¦ä¹ å™¨è‡ªåŠ¨ç»„åˆ

### 2. è®­ç»ƒç­–ç•¥ä¼˜åŒ–

**é—®é¢˜é©±åŠ¨è¿­ä»£**:
1. **é—®é¢˜**: ç‰¹å¾è¡¨è¾¾èƒ½åŠ›ä¸è¶³ â†’ **è§£å†³**: å¤šå¤´èåˆ
2. **é—®é¢˜**: ç®€å•æ ·æœ¬æƒé‡è¿‡å¤§ â†’ **è§£å†³**: Focal Loss
3. **é—®é¢˜**: æ¨¡å‹åŒè´¨åŒ– â†’ **è§£å†³**: å¤šç§å­è®­ç»ƒ
4. **é—®é¢˜**: ç®€å•å¹³å‡æ•ˆæœæœ‰é™ â†’ **è§£å†³**: Stackingé›†æˆ

### 3. å·¥ç¨‹å®è·µ

**å¯å¤ç°æ€§**:
- å›ºå®šéšæœºç§å­
- è¯¦ç»†é…ç½®è®°å½•
- å®Œæ•´è®­ç»ƒæ—¥å¿—

**å¯æ‰©å±•æ€§**:
- æ¨¡å—åŒ–è®¾è®¡
- é…ç½®æ–‡ä»¶é©±åŠ¨
- æ’ä»¶å¼æ¶æ„

**å¯ç»´æŠ¤æ€§**:
- æ¸…æ™°ä»£ç ç»“æ„
- è¯¦ç»†æ–‡æ¡£è¯´æ˜
- ç‰ˆæœ¬æ§åˆ¶ç®¡ç†

---

## ğŸ“š å­¦ä¹ ä»·å€¼

### 1. æ·±åº¦å­¦ä¹ æŠ€æœ¯æ ˆ

**æ¨¡å‹æ¶æ„**:
- ResNetæ®‹å·®ç½‘ç»œ
- FPNç‰¹å¾é‡‘å­—å¡”
- SEæ³¨æ„åŠ›æœºåˆ¶
- ç‰¹å¾èåˆæ–¹æ³•

**è®­ç»ƒæŠ€å·§**:
- æŸå¤±å‡½æ•°è®¾è®¡
- ä¼˜åŒ–å™¨é€‰æ‹©
- å­¦ä¹ ç‡è°ƒåº¦
- æ­£åˆ™åŒ–æŠ€æœ¯

**é›†æˆå­¦ä¹ **:
- Stackingæ–¹æ³•
- å…ƒå­¦ä¹ å™¨
- äº¤å‰éªŒè¯
- æ¨¡å‹é€‰æ‹©

### 2. å·¥ç¨‹å®è·µ

**ä»£ç ç»„ç»‡**:
- æ¨¡å—åŒ–è®¾è®¡
- é…ç½®ç®¡ç†
- æ—¥å¿—è®°å½•
- é”™è¯¯å¤„ç†

**æ€§èƒ½ä¼˜åŒ–**:
- æ··åˆç²¾åº¦è®­ç»ƒ
- å†…å­˜ç®¡ç†
- å¹¶è¡Œè®¡ç®—
- ç¼“å­˜ç­–ç•¥

**å®éªŒç®¡ç†**:
- ç‰ˆæœ¬æ§åˆ¶
- ç»“æœè¿½è¸ª
- å¯è§†åŒ–åˆ†æ
- æŠ¥å‘Šç”Ÿæˆ

---

## ğŸ“ é€‚ç”¨åœºæ™¯

### 1. å­¦æœ¯ç ”ç©¶

- **æœºå™¨å­¦ä¹ è¯¾ç¨‹**: å®Œæ•´çš„ä¼˜åŒ–æ¡ˆä¾‹
- **æ·±åº¦å­¦ä¹ å®è·µ**: ç°ä»£æŠ€æœ¯æ ˆåº”ç”¨
- **é›†æˆå­¦ä¹ ç ”ç©¶**: Stackingæ–¹æ³•å®ç°
- **æ¨¡å‹æ¶æ„è®¾è®¡**: æ®‹å·®ç½‘ç»œ + æ³¨æ„åŠ›æœºåˆ¶

### 2. å·¥ç¨‹å®è·µ

- **æ¨¡å‹ä¼˜åŒ–**: ä»57%åˆ°93%çš„å®Œæ•´æµç¨‹
- **ä»£ç æ¶æ„**: å¯å¤ç°ã€å¯æ‰©å±•çš„è®¾è®¡
- **å®éªŒç®¡ç†**: ç³»ç»ŸåŒ–çš„è¿­ä»£æ–¹æ³•
- **æ€§èƒ½è°ƒä¼˜**: å¤šç§ä¼˜åŒ–æŠ€æœ¯åº”ç”¨

### 3. æŠ€æœ¯å­¦ä¹ 

- **PyTorchå®è·µ**: ç°ä»£æ·±åº¦å­¦ä¹ æ¡†æ¶
- **è®­ç»ƒæŠ€å·§**: æ··åˆç²¾åº¦ã€æ¢¯åº¦è£å‰ªç­‰
- **é›†æˆæ–¹æ³•**: å…ƒå­¦ä¹ å™¨è®¾è®¡
- **å¯è§†åŒ–åˆ†æ**: æ€§èƒ½ç›‘æ§å’Œå¯¹æ¯”

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### 1. ç«‹å³å¼€å§‹

```bash
# 1. è¿›å…¥ç›®å½•
cd mnist-demo

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¿«é€Ÿæµ‹è¯•
quick_test.bat

# 4. å¼€å§‹è®­ç»ƒ
train_all_stages.bat
```

### 2. æ·±å…¥å­¦ä¹ 

- é˜…è¯» `TRAINING_GUIDE.md` äº†è§£è®­ç»ƒç»†èŠ‚
- ç ”ç©¶ `src/models/` ä¸­çš„æ¨¡å‹æ¶æ„
- åˆ†æ `scripts/training/` ä¸­çš„è®­ç»ƒç­–ç•¥
- æŸ¥çœ‹ `PRESENTATION_GUIDE.md` å‡†å¤‡æ¼”è®²

### 3. æ‰©å±•åº”ç”¨

- å°è¯•æ–°çš„æ¨¡å‹æ¶æ„
- å®éªŒä¸åŒçš„æŸå¤±å‡½æ•°
- ä¼˜åŒ–è®­ç»ƒè¶…å‚æ•°
- åº”ç”¨åˆ°å…¶ä»–æ•°æ®é›†

---

## ğŸ‰ æ€»ç»“

**mnist-demo** æ–‡ä»¶å¤¹ç°åœ¨åŒ…å«äº†ï¼š

âœ… **å®Œæ•´çš„è®­ç»ƒä»£ç ** - ä»Stage 1åˆ°Stage 4çš„æ‰€æœ‰è®­ç»ƒè„šæœ¬  
âœ… **æ¨¡å‹æƒé‡æ–‡ä»¶** - 11ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹ + Stackingç»“æœ  
âœ… **æµ‹è¯•è„šæœ¬** - å•æ¨¡å‹æµ‹è¯• + å…¨æ¨¡å‹å¯¹æ¯”  
âœ… **è¯¦ç»†æ–‡æ¡£** - ä»å¿«é€Ÿå¼€å§‹åˆ°æŠ€æœ¯ç»†èŠ‚  
âœ… **ä¸€é”®è„šæœ¬** - å¿«é€Ÿæµ‹è¯• + å®Œæ•´è®­ç»ƒ  

**è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€å¯å¤ç°çš„ã€å¯å­¦ä¹ çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ï¼** ğŸš€

---

**åˆ›å»ºæ—¶é—´**: 2024å¹´10æœˆ24æ—¥  
**é¡¹ç›®çŠ¶æ€**: âœ… å®Œæˆ  
**æœ€ç»ˆæ€§èƒ½**: éªŒè¯é›†93.09%ï¼Œæµ‹è¯•é›†90.30%  
**æŠ€æœ¯æ ˆ**: PyTorch + LightGBM + ç°ä»£æ·±åº¦å­¦ä¹ æŠ€æœ¯
