# 高级集成方法对比测试报告

## 测试概述

本报告对比了四种不同的集成方法在MNIST数字比较任务上的性能：

1. **基线方法** - 简单平均
2. **MC Dropout + 动态权重** - 蒙特卡洛Dropout与动态权重结合
3. **两层Stacking + 动态权重** - 分层Stacking与动态权重结合  
4. **原始Stacking** - 基于LightGBM的传统Stacking方法

## 验证集结果 (val.npz)

| 方法 | 准确率 | F1 Score | 备注 |
|------|--------|----------|------|
| **原始Stacking (LightGBM)** | **0.8912** | **0.8912** | 🏆 最佳性能 |
| 两层Stacking + 动态权重 | 0.8890 | 0.8890 | 次佳性能 |
| MC Dropout + 动态权重 | 0.8767 | 0.8762 | 提供不确定性估计 |
| 基线 (简单平均) | 0.8913 | 0.8915 | 基线参考 |

## 测试集结果 (test_public.npz)

| 方法 | 准确率 | F1 Score | 备注 |
|------|--------|----------|------|
| **两层Stacking + 动态权重** | **0.9240** | **0.9240** | 🏆 测试集最佳 |
| 基线 (简单平均) | 0.8845 | 0.8789 | 基线参考 |

## 详细分析

### 1. 原始Stacking (LightGBM) - 验证集最佳
- **优势**: 在验证集上表现最佳，5折交叉验证稳定
- **特点**: 使用LightGBM作为元学习器，训练速度快
- **Fold准确率**: [0.8910, 0.9010, 0.8870, 0.8995, 0.8775]

### 2. 两层Stacking + 动态权重 - 测试集最佳
- **优势**: 在测试集上表现最佳，泛化能力强
- **特点**: 
  - 4个模型分组，每组合2个模型
  - 平均置信度: 0.8242
  - 权重分布熵: 1.384 (表示权重分布相对均匀)

### 3. MC Dropout + 动态权重
- **特点**: 
  - 提供不确定性估计 (平均不确定性: 0.0425)
  - 高置信度预测 (平均置信度: 0.9596)
  - MC采样次数: 10次
- **优势**: 能够量化预测的不确定性

### 4. 基线方法 (简单平均)
- **特点**: 最简单的集成方法
- **性能**: 在验证集上表现良好，但测试集上不如Stacking方法

## 关键发现

1. **验证集 vs 测试集性能差异**:
   - 原始Stacking在验证集上最佳 (0.8912)
   - 两层Stacking在测试集上最佳 (0.9240)
   - 说明两层Stacking具有更好的泛化能力

2. **动态权重的效果**:
   - 两层Stacking + 动态权重比简单平均有提升
   - MC Dropout + 动态权重提供额外的不确定性信息

3. **模型数量影响**:
   - 使用了8个预训练模型
   - 所有方法都能有效利用多个模型的预测

## 推荐使用策略

1. **生产环境**: 使用**两层Stacking + 动态权重**，因为它在测试集上表现最佳
2. **需要不确定性估计**: 使用**MC Dropout + 动态权重**
3. **快速部署**: 使用**原始Stacking (LightGBM)**
4. **简单场景**: 使用**基线方法 (简单平均)**

## 技术实现要点

1. **正确的模型加载**: 使用与原始Stacking相同的模型加载方式
2. **路径管理**: 正确处理相对路径和绝对路径
3. **数据预处理**: 确保数据格式与模型期望一致
4. **错误处理**: 添加适当的异常处理和边界情况检查

## 结论

通过对比测试，我们发现：

- **两层Stacking + 动态权重**在测试集上表现最佳，推荐用于生产环境
- **原始Stacking**在验证集上表现最佳，适合快速原型开发
- **MC Dropout + 动态权重**提供不确定性估计，适合需要置信度信息的场景
- 所有方法都显著优于单个模型的性能

测试成功验证了高级集成方法的有效性，为实际应用提供了多种选择。
